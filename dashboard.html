<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>I-MEDAS Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f0f0;
        }
        .container {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        h1, h2 {
            color: #333;
        }
        .chart-container {
            margin-bottom: 30px;
        }
       body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f0f0;
        }
        .container {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        h1, h2 {
            color: #333;
        }
        .chart-container {
            margin-bottom: 30px;
        }
        .score-table {
            font-size: 0.8em;
        }
        .score-table th, .score-table td {
            text-align: center;
            vertical-align: middle;
        }
        .score-cell {
            cursor: pointer;
            position: relative;
        }
        .tooltip {
            position: absolute;
            background-color: rgba(0,0,0,0.8);
            color: white;
            padding: 5px;
            border-radius: 3px;
            font-size: 0.9em;
            z-index: 1000;
            display: none;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            white-space: nowrap;
            margin-bottom: 5px;
        }
        .tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: rgba(0,0,0,0.8) transparent transparent transparent;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-center mb-4">I-MEDAS Dashboard</h1>
        <h2 id="userId" class="text-center mb-4"></h2>
        
        <div class="row">
            <div class="col-md-6 chart-container">
                <canvas id="overallScoreChart"></canvas>
            </div>
            <div class="col-md-6 chart-container">
                <canvas id="averageQuestionScoresChart"></canvas>
            </div>
        </div>
        
        <div class="row">
            <div class="col-md-12 chart-container">
                <canvas id="progressChart"></canvas>
            </div>
        </div>
                 <div class="row mt-5">
            <div class="col-12">
                <h3>פירוט הציונים לפי שאלה ותאריך</h3>
                <div class="table-responsive">
                    <table id="scoreTable" class="table table-bordered score-table">
                        <!-- Table content will be dynamically generated -->
                    </table>
                </div>
            </div>
        </div>
    </div>

<script>
    // Sample data for a specific ID with 9 entries
     const sampleData = [
            { date: '2024-01-01', scores: [1,1,0,1,1,1,0,1,1,0,1,1,0,1,1,0,1], totalScore: 12, userValues: [6,1,0,1,1,1,0,1,1,0,1,1,0,1,1,0,1] },
            { date: '2024-02-01', scores: [1,1,1,1,1,1,0,1,1,1,1,1,0,1,1,1,1], totalScore: 15, userValues: [1,1,3,1,1,1,0,1,1,8,1,1,0,1,1,1,1] },
            { date: '2024-03-01', scores: [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1], totalScore: 17, userValues: [1,1,2,1,1,1,3,1,1,7,1,1,3,1,1,1,1] },
            { date: '2024-04-01', scores: [1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1], totalScore: 16, userValues: [1,1,2,1,1,1,3,1,1,7,1,1,0,1,1,1,1] },
            { date: '2024-05-01', scores: [1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,0,1], totalScore: 15, userValues: [1,1,2,1,1,1,3,1,1,0,1,1,3,1,1,0,1] },
            { date: '2024-06-01', scores: [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0], totalScore: 16, userValues: [1,1,2,1,1,1,3,1,1,7,1,1,3,1,1,1,0] },
            { date: '2024-07-01', scores: [1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1], totalScore: 16, userValues: [1,1,2,1,1,1,0,1,1,7,1,1,3,1,1,1,1] },
            { date: '2024-08-01', scores: [1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1], totalScore: 16, userValues: [1,1,2,1,1,1,3,1,1,7,1,1,3,1,0,1,1] },
            { date: '2024-09-01', scores: [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1], totalScore: 17, userValues: [1,1,2,1,1,1,3,1,1,7,1,1,3,1,1,1,1] }
        ];

    const userId = 'ABC123'; // Example user ID

    document.getElementById('userId').textContent = `מזהה משתמש: ${userId}`;

    // Overall Score Chart
    const overallScoreCtx = document.getElementById('overallScoreChart').getContext('2d');
    new Chart(overallScoreCtx, {
        type: 'line',
        data: {
            labels: sampleData.map(d => d.date),
            datasets: [{
                label: 'ציון כולל',
                data: sampleData.map(d => d.totalScore),
                borderColor: 'rgb(75, 192, 192)',
                tension: 0.1
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: {
                    beginAtZero: true,
                    max: 17
                }
            }
        }
    });

    // Calculate average scores for each question
    const averageScores = sampleData[0].scores.map((_, index) => {
        const sum = sampleData.reduce((acc, curr) => acc + curr.scores[index], 0);
        return sum / sampleData.length;
    });

    // Average Question Scores Chart
    const averageQuestionScoresCtx = document.getElementById('averageQuestionScoresChart').getContext('2d');
    new Chart(averageQuestionScoresCtx, {
        type: 'bar',
        data: {
            labels: Array.from({length: 17}, (_, i) => `שאלה ${i+1}`),
            datasets: [{
                label: 'ציון ממוצע לשאלה',
                data: averageScores,
                backgroundColor: 'rgba(75, 192, 192, 0.6)'
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: {
                    beginAtZero: true,
                    max: 1
                }
            }
        }
    });

    // Progress Chart
    const progressCtx = document.getElementById('progressChart').getContext('2d');
    new Chart(progressCtx, {
        type: 'line',
        data: {
            labels: sampleData.map(d => d.date),
            datasets: sampleData[0].scores.map((_, index) => ({
                label: `שאלה ${index + 1}`,
                data: sampleData.map(d => d.scores[index]),
                borderColor: `hsl(${index * 20}, 70%, 50%)`,
                tension: 0.1
            }))
        },
        options: {
            responsive: true,
            scales: {
                y: {
                    beginAtZero: true,
                    max: 1
                }
            }
        }
    });
 function generateScoreTable() {
            const table = document.getElementById('scoreTable');
            let html = '<thead><tr><th>שאלה / תאריך</th>';
            
            sampleData.forEach(data => {
                html += `<th>${data.date}</th>`;
            });
            
            html += '</tr></thead><tbody>';
            
            for (let i = 0; i < 17; i++) {
                html += `<tr><td>שאלה ${i + 1}</td>`;
                sampleData.forEach(data => {
                    html += `<td class="score-cell" data-score="${data.scores[i]}" data-value="${data.userValues[i]}">${data.scores[i]}</td>`;
                });
                html += '</tr>';
            }
            
            html += '</tbody>';
            table.innerHTML = html;

            // Add event listeners for click effect
            const cells = document.querySelectorAll('.score-cell');
            cells.forEach(cell => {
                cell.addEventListener('click', toggleTooltip);
            });

            // Add event listener to close tooltip when clicking outside
            document.addEventListener('click', (event) => {
                if (!event.target.closest('.score-cell')) {
                    hideAllTooltips();
                }
            });
        }

        function toggleTooltip(event) {
            event.stopPropagation();
            const cell = event.target;
            const value = cell.dataset.value;
            
            hideAllTooltips();

            let tooltip = cell.querySelector('.tooltip');
            if (!tooltip) {
                tooltip = document.createElement('div');
                tooltip.className = 'tooltip';
                cell.appendChild(tooltip);
            }
            
            tooltip.textContent = `ערך המשתמש: ${value}`;
            tooltip.style.display = tooltip.style.display === 'none' ? 'block' : 'none';
        }

        function hideAllTooltips() {
            const tooltips = document.querySelectorAll('.tooltip');
            tooltips.forEach(tooltip => {
                tooltip.style.display = 'none';
            });
        }

        // Call the function to generate the table
        generateScoreTable();
</script>
</body>
</html>